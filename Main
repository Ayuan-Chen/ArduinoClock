#include <MsTimer2.h>
#include <LiquidCrystal.h>

const int rs = 8, rw = 11, en = 9 , d4 = 4, d5 = 5, d6 = 6, d7 = 7;
LiquidCrystal lcd(rs, en, d4, d5, d6, d7);


int Sec=53,Min=59,Hour=23,Day=28,Month=2,Year=2021;       //默认时间2021-2-28 23：59：55
int i=9,j=0;    //控制滚动字幕
int StaDay=0;   //标准日期

void timer0()
{
   Sec++;
}


void setup(){
   MsTimer2::set(1000,timer0) ;
   MsTimer2::start();
   lcd.begin(16,2);
   lcd.clear();
}


void timeRun(){

/*Display第一行*/
  lcd.setCursor(0,0);

//年份
  lcd.print(Year);    
  lcd.print("-");
  

//月份
  if(Month>12){
    Month=1;
    Year++;
  }
  if(Month<10){
    lcd.print("0");
    lcd.print(Month);
  }else{
    lcd.print(Month);
  }
  lcd.print("-");
  
  //日期
  if(Month != 2){     
        switch(Month){       
            case 1: case 3: case 5: case 7: case 8: case 10: case 12: StaDay= 31;  break;
            case 4: case 6: case 9: case 11:  StaDay = 30;  break;
        }
   } else{   //闰年    
        if(Year % 4 == 0 && Year % 100 != 0 || Year % 400 == 0){
            StaDay = 29;
        }   
        else{
            StaDay = 28;   
        }     
    }  
  if(Day>StaDay){
    Day=1;
    Month++;
  }
  if(Day<10){
    lcd.print("0");
    lcd.print(Day);
  }else{
    lcd.print(Day);
  }
  lcd.print(" ");


//星期
int week = (Day+2*Month+3*(Month+1)/5+Year+Year/4-Year/100+Year/400)%7+1; 
String weekstr = "";
switch(week){     
        case 1: weekstr = "Mon. ";   break;
        case 2: weekstr = "Tues. ";  break;
        case 3: weekstr = "Wed. ";   break;
        case 4: weekstr = "Thur. ";  break;
        case 5: weekstr = "Fri. ";   break;
        case 6: weekstr = "Sat. ";   break;
        case 7: weekstr = "Sun. ";   break;
 }    
 lcd.setCursor(11, 0);  lcd.print(weekstr);
  
/*Display第二行*/
lcd.setCursor(0,1);

  
//小时
  if(Hour==24){
    Hour=0;
    Day++;
  }
  if(Hour<10){
    lcd.print("0");
    lcd.print(Hour);
  }else{
    lcd.print(Hour);
  }
  lcd.print(":");

//分钟
  if(Min==60){
    Min=0;
    Hour++;
   }
   if(Min<10){
    lcd.print("0");
    lcd.print(Min);
  }else{
    lcd.print(Min);
  }
  lcd.print(":");


//秒钟
  if(Sec==60){
    Sec=0;
    Min++;
   }
   if(Sec<10){
    lcd.print("0");
    lcd.print(Sec);
  }else{
    lcd.print(Sec);
  }
 
}

//滚动字幕
void CircleChara(){
  if(j%200==0){
  lcd.setCursor(8,1);
  lcd.print("          ");
  lcd.setCursor(i,1);
  lcd.print("&Csy");
  if(i==15){
    i=8;
  }
  i++;
  }
  j++;
}


void loop(){
  CircleChara();
  timeRun();
}